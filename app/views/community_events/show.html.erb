<% content_for :title, "#{@event.title} - #{@community.name}" %>

<div style="max-width: 800px; margin: 2rem auto; padding: 0 1rem;">
  <div style="margin-bottom: 2rem;">
    <%= link_to "← Back to #{@community.name}", @community, style: "color: #666; text-decoration: none;" %>
  </div>

  <!-- Event Header -->
  <header style="background: #e3f2fd; border: 1px solid #bbdefb; border-radius: 1rem; padding: 2rem; margin-bottom: 2rem;">
    <h1 style="font-size: 2rem; font-weight: 600; color: #1565c0; margin-bottom: 0.5rem;">
      <%= @event.title %>
    </h1>
    <div style="color: #1565c0; font-size: 1.1rem; margin-bottom: 1rem;">
      📅 <%= @event.event_date.strftime("%B %d, %Y") %>
      <% if @event.days_until >= 0 %>
        • <%= pluralize(@event.days_until, 'day') %> away
      <% end %>
    </div>
    <% if @event.description.present? %>
      <p style="color: #1565c0; font-size: 1rem; line-height: 1.5;">
        <%= @event.description %>
      </p>
    <% end %>
  </header>

  <!-- Linked Wishlists -->
  <% if @event.wishlists.any? %>
    <section>
      <h2 style="font-size: 1.5rem; font-weight: 500; color: #000; margin-bottom: 1.5rem;">
        Linked Wishlists (<%= @event.wishlists.count %>)
      </h2>
      <p style="color: #666; margin-bottom: 2rem;">
        These wishlists are perfect for finding gifts for this event!
      </p>

      <div style="display: grid; gap: 1.5rem;">
        <% @event.wishlists.includes(:user, :wishlist_items).each do |wishlist| %>
          <article style="background: #fff; border: 1px solid #eee; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
              <div>
                <h3 style="font-size: 1.2rem; font-weight: 500; color: #000; margin-bottom: 0.5rem;">
                  <%= wishlist.title %>
                </h3>
                <div style="color: #666; font-size: 0.9rem;">
                  by <%= wishlist.user.name.presence || wishlist.user.email.split('@').first.humanize %>
                  • <%= pluralize(wishlist.wishlist_items.count, 'item') %>
                </div>
              </div>
              <%= link_to "View Wishlist", wishlist_path(wishlist), 
                  style: "background: #261B23; color: #fff; padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; font-size: 0.9rem;" %>
            </div>

            <% if wishlist.description.present? %>
              <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
                <%= truncate(wishlist.description, length: 150) %>
              </p>
            <% end %>

            <!-- Preview of wishlist items -->
            <% if wishlist.wishlist_items.any? %>
              <div style="background: #f8f9fa; border-radius: 0.5rem; padding: 1rem;">
                <h4 style="font-size: 0.9rem; font-weight: 500; color: #666; margin-bottom: 0.5rem;">
                  Items preview:
                </h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                  <% wishlist.wishlist_items.limit(3).each do |item| %>
                    <li style="padding: 0.25rem 0; color: #666; font-size: 0.85rem;">
                      • <%= truncate(item.name, length: 40) %>
                      <% if item.being_bought? %>
                        <span style="color: #28a745; font-size: 0.8rem;">✓ Reserved</span>
                      <% end %>
                    </li>
                  <% end %>
                  <% if wishlist.wishlist_items.count > 3 %>
                    <li style="padding: 0.25rem 0; color: #999; font-size: 0.8rem; font-style: italic;">
                      +<%= wishlist.wishlist_items.count - 3 %> more items
                    </li>
                  <% end %>
                </ul>
              </div>
            <% end %>
          </article>
        <% end %>
      </div>
    </section>
  <% else %>
    <div style="text-align: center; color: #666; padding: 3rem;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">🎁</div>
      <h3 style="font-size: 1.3rem; font-weight: 500; margin-bottom: 0.5rem;">No wishlists linked yet</h3>
      <p>Event organizers can link member wishlists to help with gift coordination.</p>
    </div>
  <% end %>

  <!-- Event Actions -->
  <% if @community.can_manage_members?(current_user) %>
    <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #eee; text-align: center;">
      <%= link_to "Edit Event", edit_community_community_event_path(@community, @event), 
          class: "btn secondary", style: "margin-right: 1rem;" %>
      <%= link_to "Delete Event", [@community, @event], 
          method: :delete,
          data: { 
            confirm: "Are you sure you want to delete this event?",
            turbo_method: :delete
          },
          class: "btn danger" %>
    </div>
  <% end %>
</div>